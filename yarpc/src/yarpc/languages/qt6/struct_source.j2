/* Generated by YARPC
 * Version:  {{version}}
 * Definition:
 *   File: {{ object.definitionPath }}
 *   Object: {{ object.name }}
 *   Template: qt6/struct_source.j2
 */
{% import "dbus/common.j2" as dbus %}
{% import "qt6/common.j2" as qt6 %}
#include <QMetaType>
#include <QDBusMetaType>
#include "{{ object.name }}.hpp"
#include "types.hpp"

using namespace {{ qt6.namespace(output) }};

QDBusArgument &{{ qt6.namespace(output) }}::operator<<(QDBusArgument &argument, const {{ object.name }} &object) {
    argument.beginStructure();
    {% for member in object.members %}
    argument << {{ qt6.force_cast("object."+(member.name|camel_case), member.type, output.objects, dbus=true) }};
    {% endfor %}
    argument.endStructure();
    return argument;
}

const QDBusArgument &{{ qt6.namespace(output) }}::operator>>(const QDBusArgument &argument, {{ object.name }} &object) {
    argument.beginStructure();
    {% for member in object.members %}
    {% if qt6.type(member.type, output.objects, dbus=false) != qt6.type(member.type, output.objects, dbus=true) %}
    {{ qt6.type(member.type, output.objects, dbus=true) }} dbus{{ member.name|pascal_case }};
    argument >> dbus{{ member.name|pascal_case }};
    object.{{ member.name|camel_case }} = {{ qt6.force_cast("dbus"+(member.name|pascal_case), member.type, output.objects, dbus=false) }};
    {% else%}
    argument >> object.{{ member.name|camel_case }};
    {% endif %}
    {% endfor %}
    argument.endStructure();
    return argument;
}

bool {{ qt6.namespace(output) }}::operator!=(const {{ object.name }} &lhs, const {{ object.name }} &rhs) {
    return (false
        {% for member in object.members %}
        || lhs.{{ member.name|camel_case }} != rhs.{{ member.name|camel_case }}
        {% endfor %}
    );
}

{{ object.name }} {{object.name}}Factory::create (
    {% if object.members|count > 0 %}
    {{ qt6.funcparams(object.members, output.objects)|indent(4) }}
    {% endif %}
) const {
    return {{ object.name }} {
        {% for member in object.members %}
        .{{ member.name|camel_case }} = {{ member.name | camel_case }},
        {% endfor %}
    };
}

{{ object.name }} {{object.name}}Factory::create (
    {% if object.members|count > 0 %}
    {{ qt6.funcparams(object.members, output.objects, true)|indent(4) }}
    {% endif %}
) const {
    {% for i in range(0, object.members|count) %}
    {% set member = object.members[i] %}
    {{ qt6.unmarshalVariant(member.name, member.type, "member_"+i|string, output.objects)|indent(4) }}
    {% endfor%}
    return {{ object.name }} {
        {% for i in range(0, object.members|count) %}
        {% set member = object.members[i] %}
        .{{ member.name|camel_case }} = member_{{i}},
        {% endfor %}
    };
}
